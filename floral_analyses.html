<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="John M. Powers, Heather M. Briggs, Rachel G. Dickson, Xinyu Li, Diane R. Campbell" />

<meta name="date" content="2021-09-25" />

<title>Code for “Earlier snowmelt and reduced summer precipitation alter floral traits important to pollination”</title>

<script src="libs/header-attrs-2.8/header-attrs.js"></script>
<script src="libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="libs/navigation-1.1/tabsets.js"></script>
<script src="libs/navigation-1.1/codefolding.js"></script>
<link href="libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>








<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Code for “Earlier snowmelt and reduced summer precipitation alter floral traits important to pollination”</h1>
<h4 class="author">John M. Powers, Heather M. Briggs, Rachel G. Dickson, Xinyu Li, Diane R. Campbell</h4>
<h4 class="date">2021-09-25</h4>

</div>


<style type="text/css">
.main-container { max-width: 1000px; margin-left: 0; margin-right: auto; }
img{ max-width:200%; height: auto; }
td, th { padding : 6px }
</style>
<pre class="r"><code>library(tidyverse)
library(lubridate)

library(lme4)
library(lmerTest)
library(MuMIn)
library(glmmTMB)
library(emmeans)
library(broom)
library(broom.mixed)
library(vegan)

library(RColorBrewer)
library(viridis)
library(gridExtra)
library(GGally)
library(ggvegan)
library(ggfortify) 
library(ggnewscale)
library(ggpattern)
library(ggpmisc)

library(knitr)
knitr::opts_chunk$set(comment=&quot;&quot;, cache=F, warning = F, message = F, fig.path = &quot;figures/&quot;, dev=&quot;svg&quot;)
options(digits=4) # for kables

load(&quot;data/maxfield_data.rda&quot;)
load(&quot;data/daily_all.rda&quot;)

options(contrasts = c(&quot;contr.sum&quot;, &quot;contr.poly&quot;)) #needed for Type III SS

anova_table &lt;- function(df, mod) { #for lmer models and lmerTest::anova
  df %&gt;% select(trait, term, p.value) %&gt;% 
    pivot_wider(names_from=term, values_from=p.value) %&gt;% 
    mutate(R2m = map_dbl(mod, ~ MuMIn::r.squaredGLMM(.x)[[1,&quot;R2m&quot;]]))
}
select &lt;- dplyr::select
snow_pal_grey &lt;- c(&quot;grey50&quot;,&quot;black&quot;)</code></pre>
<div id="metadata" class="section level1">
<h1>Metadata</h1>
<pre class="r"><code>alldata &lt;- list(&quot;snowmelt&quot;=groundcover %&gt;% select(source, year, contains(&quot;cm_day&quot;), precip_est_mm),
                &quot;treatments&quot;=treatments %&gt;% select(year, plotid, water, water4, snow, sun_date,precip_est_mm),
                &quot;soil_moisture&quot;=sm.subplotyear %&gt;% select(year, plotid, VWC),
                &quot;traits&quot;=mnps.plantyr %&gt;% select(year, plotid, plant, any_of(floraltraits)) %&gt;% 
                  arrange(year, plotid) %&gt;% drop_na(plant) %&gt;% filter(plant!=&quot;NA&quot;))

purrr::walk(names(alldata), ~write_tsv(alldata[[.]], paste0(&quot;data/&quot;,., &quot;.tsv&quot;), na=&quot;&quot;))</code></pre>
<p>The following four datasets are available in tab-delimited (TSV) format under the ‘data’ folder.</p>
<div id="snowmelt" class="section level2">
<h2>Snowmelt</h2>
<table>
<caption>Records of observed or inferred snowmelt timing from 1935 - 2021 in Gothic, CO, USA.</caption>
<colgroup>
<col width="22%" />
<col width="77%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Column</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">source</td>
<td align="left">data source (billy: <a href="http://www.gothicwx.org/ground-cover.html">billy barr’s plot observations</a> in Gothic, CO; streamflow: estimates from amount of peak runoff in the East River reported in <a href="https://doi.org/10.1104/pp.112.206219">Anderson et al. 2012 <em>Plant Physiology</em></a>)</td>
</tr>
<tr class="even">
<td align="left">year</td>
<td align="left">year</td>
</tr>
<tr class="odd">
<td align="left">first_100_cm_day</td>
<td align="left">day of the year the the snowpack first dropped below 100 cm</td>
</tr>
<tr class="even">
<td align="left">first_50_cm_day</td>
<td align="left">day of the year the the snowpack first dropped below 50 cm</td>
</tr>
<tr class="odd">
<td align="left">first_0_cm_day</td>
<td align="left">day of the year the the snowpack first melted completely (snowmelt date)</td>
</tr>
<tr class="even">
<td align="left">precip_est_mm</td>
<td align="left">summer precipitation from snowmelt date to day 214 (see Methods S1)</td>
</tr>
</tbody>
</table>
</div>
<div id="treatments" class="section level2">
<h2>Treatments</h2>
<table>
<caption>The precipitation and snowmelt treatments in the split-plot design, with snowmelt dates for each plot and precipitation totals for each subplot.</caption>
<colgroup>
<col width="22%" />
<col width="77%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Column</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">year</td>
<td align="left">year</td>
</tr>
<tr class="even">
<td align="left">plotid</td>
<td align="left">plot number and subplot letter</td>
</tr>
<tr class="odd">
<td align="left">water</td>
<td align="left">precipitation treatment, with mock rainouts combined with controls</td>
</tr>
<tr class="even">
<td align="left">water4</td>
<td align="left">precipitation treatment, with mock rainouts separate from controls</td>
</tr>
<tr class="odd">
<td align="left">snow</td>
<td align="left">snowmelt treatment (in 2019, plot 2 was covered but coded as normal)</td>
</tr>
<tr class="even">
<td align="left">sun_date</td>
<td align="left">snowmelt date in each plot, determined by sunlight threshold</td>
</tr>
<tr class="odd">
<td align="left">precip_est_mm</td>
<td align="left">estimated summer precipitation in each subplot (see Methods S1)</td>
</tr>
</tbody>
</table>
</div>
<div id="soil-moisture" class="section level2">
<h2>Soil moisture</h2>
<table>
<caption>Summer averages of soil moisture in each subplot.</caption>
<colgroup>
<col width="22%" />
<col width="77%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Column</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">year</td>
<td align="left">year</td>
</tr>
<tr class="even">
<td align="left">plotid</td>
<td align="left">plot number and subplot letter</td>
</tr>
<tr class="odd">
<td align="left">VWC</td>
<td align="left">% volumetric water content, averaged within a subplot for each date and then averaged across each summer</td>
</tr>
</tbody>
</table>
</div>
<div id="traits" class="section level2">
<h2>Traits</h2>
<table>
<caption>Summer averages of traits for each flowering plant.</caption>
<thead>
<tr class="header">
<th align="left">Column</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">year</td>
<td align="left">year</td>
</tr>
<tr class="even">
<td align="left">plotid</td>
<td align="left">plot number and subplot letter</td>
</tr>
<tr class="odd">
<td align="left">plant</td>
<td align="left">unique plant identifier</td>
</tr>
<tr class="even">
<td align="left">corolla_length</td>
<td align="left">length of the corolla (mm)</td>
</tr>
<tr class="odd">
<td align="left">style_length</td>
<td align="left">length of the style (mm)</td>
</tr>
<tr class="even">
<td align="left">corolla_width</td>
<td align="left">width of the corolla at the opening (mm)</td>
</tr>
<tr class="odd">
<td align="left">sepal_width</td>
<td align="left">width of one sepal at its widest point (mm)</td>
</tr>
<tr class="even">
<td align="left">nectar_24_h_ul</td>
<td align="left">nectar production (µL/day)</td>
</tr>
<tr class="odd">
<td align="left">nectar_conc</td>
<td align="left">nectar sucrose concentration (% by mass)</td>
</tr>
<tr class="even">
<td align="left">height_cm</td>
<td align="left">inflorescence height (cm)</td>
</tr>
<tr class="odd">
<td align="left">flowers_est</td>
<td align="left">total number of flowers produced during the growing season</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="sample-sizes" class="section level1">
<h1>Sample sizes</h1>
<pre class="r"><code>years_flowering &lt;- with(cen.status, table(flowering_status_18 + flowering_status_19 + flowering_status_20))

count_measurements &lt;- function(df, tr) summarize(df, across(all_of(tr), ~ sum(!is.na(.x))))

bind_rows(n_measurements = count_measurements(bind_rows(mnps, lt, pt), floraltraits),
          plant_year = count_measurements(bind_rows(mnps, lt, pt) %&gt;% group_by(year, plantid) %&gt;% 
                                            summarize(across(all_of(floraltraits), mean, na.rm=T)), floraltraits) %&gt;% 
            ungroup %&gt;% summarize(across(all_of(floraltraits), sum)),
          plant =       count_measurements(bind_rows(mnps, lt, pt) %&gt;% group_by(plantid) %&gt;% 
                                             summarize(across(all_of(floraltraits), mean, na.rm=T)), floraltraits),
          .id=&quot;sample_size&quot;) %&gt;% column_to_rownames(&quot;sample_size&quot;) %&gt;% 
  t %&gt;% as.data.frame %&gt;% rownames_to_column(&quot;trait&quot;) %&gt;% as_tibble %&gt;% 
  mutate(n_per_plant_year = n_measurements / plant_year,
         plant_per_subplot_per_year = plant_year / 24 / 3) %&gt;% 
  kable(digits=2, col.names=c(&quot;Trait&quot;, &quot;Total measurements&quot;, &quot;Total plant-years&quot;, 
        &quot;Total unique plants measured&quot;, &quot;Measurements / plant-year&quot;, &quot;Plants / subplot / year&quot;),
        caption=paste0(&quot;The number of unique plants is slightly less than the plant-years because &quot;, 
                       round(100*years_flowering[[&quot;2&quot;]]/(years_flowering[[&quot;1&quot;]]+years_flowering[[&quot;2&quot;]]),2),
                       &quot;% of plants flowered in 2 years.&quot;))</code></pre>
<table>
<caption>The number of unique plants is slightly less than the plant-years because 3.86% of plants flowered in 2 years.</caption>
<colgroup>
<col width="11%" />
<col width="14%" />
<col width="13%" />
<col width="22%" />
<col width="19%" />
<col width="18%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Trait</th>
<th align="right">Total measurements</th>
<th align="right">Total plant-years</th>
<th align="right">Total unique plants measured</th>
<th align="right">Measurements / plant-year</th>
<th align="right">Plants / subplot / year</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">corolla_length</td>
<td align="right">1194</td>
<td align="right">494</td>
<td align="right">484</td>
<td align="right">2.42</td>
<td align="right">6.86</td>
</tr>
<tr class="even">
<td align="left">style_length</td>
<td align="right">1185</td>
<td align="right">491</td>
<td align="right">481</td>
<td align="right">2.41</td>
<td align="right">6.82</td>
</tr>
<tr class="odd">
<td align="left">corolla_width</td>
<td align="right">963</td>
<td align="right">455</td>
<td align="right">448</td>
<td align="right">2.12</td>
<td align="right">6.32</td>
</tr>
<tr class="even">
<td align="left">sepal_width</td>
<td align="right">749</td>
<td align="right">340</td>
<td align="right">334</td>
<td align="right">2.20</td>
<td align="right">4.72</td>
</tr>
<tr class="odd">
<td align="left">nectar_24_h_ul</td>
<td align="right">744</td>
<td align="right">432</td>
<td align="right">419</td>
<td align="right">1.72</td>
<td align="right">6.00</td>
</tr>
<tr class="even">
<td align="left">nectar_conc</td>
<td align="right">656</td>
<td align="right">401</td>
<td align="right">390</td>
<td align="right">1.64</td>
<td align="right">5.57</td>
</tr>
<tr class="odd">
<td align="left">height_cm</td>
<td align="right">1865</td>
<td align="right">674</td>
<td align="right">653</td>
<td align="right">2.77</td>
<td align="right">9.36</td>
</tr>
<tr class="even">
<td align="left">flowers_est</td>
<td align="right">641</td>
<td align="right">610</td>
<td align="right">591</td>
<td align="right">1.05</td>
<td align="right">8.47</td>
</tr>
</tbody>
</table>
</div>
<div id="trait-correlations" class="section level1">
<h1>Trait correlations</h1>
<pre class="r"><code>mnps.plantyr %&gt;% select(corolla_length, corolla_width,  style_length,   anther_max, anther_min, sepal_width, nectar_24_h_ul, nectar_conc, nectar_sugar_24_h_mg, height_cm, flowers_est) %&gt;% 
  ggcorr(hjust=0.85, layout.exp=2, label=T, label_round=2)</code></pre>
<p><img src="figures/correlations-1.svg" width="672" /></p>
</div>
<div id="figure-1" class="section level1">
<h1>Figure 1</h1>
<pre class="r"><code>size_meter &lt;- 0.11
subplot_offset &lt;- size_meter * 1.5
ggplot(treatments_map %&gt;% mutate(snow=fct_relevel(snow, &quot;Normal&quot;))) + coord_fixed(clip=&quot;off&quot;)+
  geom_tile(aes(x=plot_x, y=plot_y, fill=snow), 
            width=7*size_meter, height=7*size_meter, color=&quot;black&quot;, size=0.5) +
  scale_fill_manual(&quot;Snowmelt&quot;, values=snow_pal_grey)+
  geom_tile_pattern(aes(x=plot_x+subplot_x*subplot_offset, y=plot_y+subplot_y*subplot_offset, pattern_angle=water4), 
                    fill=&quot;white&quot;, pattern_fill=&quot;black&quot;, pattern_density=0.01, pattern_spacing=0.01,
                    height=2*size_meter, width=2*size_meter, color=&quot;black&quot;, size=0.5) + 
  scale_pattern_angle_manual(&quot;Precipitation&quot;, values=c(0,45,135,90))+
  geom_text(aes(x=plot_x+subplot_x*subplot_offset, y=plot_y+subplot_y*subplot_offset, label=subplot), color=&quot;black&quot;) + 
  geom_text(aes(x=plot_x, y=plot_y, label=plot), color=&quot;white&quot;)+ theme_minimal() + 
  theme(legend.position=&quot;right&quot;, axis.title=element_blank(), axis.text = element_blank(), 
        axis.ticks = element_blank(), panel.background = element_blank(), panel.grid = element_blank())</code></pre>
<p><img src="figures/Figure_1-1.svg" width="624" /></p>
</div>
<div id="figure-2" class="section level1">
<h1>Figure 2</h1>
<pre class="r"><code>treatments %&gt;% ggplot(aes(x=sun_date, shape=year, color=water, y=precip_est_mm))+geom_point(size=2)+
  geom_point(data=groundcover, aes(x=first_0_cm_day, color=&quot;Control&quot;, shape=&quot;1990-2017&quot;), fill=&quot;white&quot;, size=2) +
  scale_color_manual(values=water_pal) + scale_shape_manual(values=c(21, 19, 17, 15))+ 
  scale_y_continuous(limits=c(0,NA), expand=expansion(mult = c(0,0.05)))+
  labs(y=&quot;Summer precipiation (mm)&quot;, x=&quot;Snowmelt date&quot;, color=&quot;Precipitation&quot;, shape=&quot;Year&quot;) + 
  theme_minimal() + theme(text=element_text(color=&quot;black&quot;, size=14), axis.text = element_text(color=&quot;black&quot;),
                            panel.border = element_rect(fill=NA, colour = &quot;black&quot;))</code></pre>
<p><img src="figures/Figure_2-1.svg" width="624" /></p>
</div>
<div id="replicated-split-plot-models" class="section level1">
<h1>Replicated split-plot models</h1>
<div id="table-1" class="section level2">
<h2>Table 1</h2>
<pre class="r"><code>options(contrasts = c(&quot;contr.sum&quot;, &quot;contr.poly&quot;))
mod.split &lt;- map(set_names(floraltraits), 
                   ~ lmer(mnps.plantyr[[.x]]  ~ year * snow * water + (1|snow:plot) + (1|snow:plotid),
                          data=mnps.plantyr))

mod.split.coefs &lt;- map_dfr(mod.split, tidy, .id=&quot;trait&quot;)
mod.split.tests &lt;- map(mod.split, anova, ddf=&quot;Ken&quot;) %&gt;% map_dfr(tidy, .id=&quot;trait&quot;)
mod.split.emm &lt;- map_dfr(mod.split, ~ summary(emmeans(ref_grid(.x), ~ year * snow * water)), .id = &quot;trait&quot;)
mod.split.tests.water &lt;- map(mod.split, multcomp::glht, 
                             linfct = multcomp::mcp(water = c(&quot;Addition - Control = 0&quot;, &quot;Reduction - Control = 0&quot;))) %&gt;% 
  map_dfr(tidy, .id=&quot;trait&quot;)

anova_table(mod.split.tests, mod.split) %&gt;% 
  left_join(mod.split.tests.water %&gt;% select(trait, contrast, adj.p.value) %&gt;% 
              pivot_wider(names_from=contrast, values_from=adj.p.value)) %&gt;% kable()</code></pre>
<table>
<colgroup>
<col width="11%" />
<col width="5%" />
<col width="5%" />
<col width="5%" />
<col width="7%" />
<col width="8%" />
<col width="8%" />
<col width="12%" />
<col width="5%" />
<col width="14%" />
<col width="15%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">trait</th>
<th align="right">year</th>
<th align="right">snow</th>
<th align="right">water</th>
<th align="right">year:snow</th>
<th align="right">year:water</th>
<th align="right">snow:water</th>
<th align="right">year:snow:water</th>
<th align="right">R2m</th>
<th align="right">Addition - Control</th>
<th align="right">Reduction - Control</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">corolla_length</td>
<td align="right">0.0000</td>
<td align="right">0.8946</td>
<td align="right">0.0025</td>
<td align="right">0.9912</td>
<td align="right">0.1473</td>
<td align="right">0.7345</td>
<td align="right">0.8934</td>
<td align="right">0.2280</td>
<td align="right">0.0299</td>
<td align="right">0.0111</td>
</tr>
<tr class="even">
<td align="left">style_length</td>
<td align="right">0.0000</td>
<td align="right">0.7633</td>
<td align="right">0.0196</td>
<td align="right">0.9797</td>
<td align="right">0.1015</td>
<td align="right">0.9313</td>
<td align="right">0.2752</td>
<td align="right">0.1847</td>
<td align="right">0.2532</td>
<td align="right">0.0394</td>
</tr>
<tr class="odd">
<td align="left">corolla_width</td>
<td align="right">0.0000</td>
<td align="right">0.7192</td>
<td align="right">0.0015</td>
<td align="right">0.5251</td>
<td align="right">0.6266</td>
<td align="right">0.4335</td>
<td align="right">0.0614</td>
<td align="right">0.3032</td>
<td align="right">0.0002</td>
<td align="right">0.2541</td>
</tr>
<tr class="even">
<td align="left">sepal_width</td>
<td align="right">0.4991</td>
<td align="right">0.9299</td>
<td align="right">0.0090</td>
<td align="right">0.1803</td>
<td align="right">0.0031</td>
<td align="right">0.3125</td>
<td align="right">0.0221</td>
<td align="right">0.1140</td>
<td align="right">0.1704</td>
<td align="right">0.0224</td>
</tr>
<tr class="odd">
<td align="left">nectar_24_h_ul</td>
<td align="right">0.0000</td>
<td align="right">0.2087</td>
<td align="right">0.0354</td>
<td align="right">0.0086</td>
<td align="right">0.7041</td>
<td align="right">0.6346</td>
<td align="right">0.4633</td>
<td align="right">0.1675</td>
<td align="right">0.0215</td>
<td align="right">0.8459</td>
</tr>
<tr class="even">
<td align="left">nectar_conc</td>
<td align="right">0.0000</td>
<td align="right">0.5226</td>
<td align="right">0.0077</td>
<td align="right">0.7581</td>
<td align="right">0.6610</td>
<td align="right">0.4919</td>
<td align="right">0.1730</td>
<td align="right">0.3083</td>
<td align="right">0.0009</td>
<td align="right">0.9985</td>
</tr>
<tr class="odd">
<td align="left">height_cm</td>
<td align="right">0.0000</td>
<td align="right">0.0797</td>
<td align="right">0.9885</td>
<td align="right">0.2403</td>
<td align="right">0.4519</td>
<td align="right">0.4824</td>
<td align="right">0.0828</td>
<td align="right">0.2340</td>
<td align="right">0.9998</td>
<td align="right">0.9851</td>
</tr>
<tr class="even">
<td align="left">flowers_est</td>
<td align="right">0.4994</td>
<td align="right">0.8003</td>
<td align="right">0.3648</td>
<td align="right">0.0094</td>
<td align="right">0.2555</td>
<td align="right">0.6195</td>
<td align="right">0.7134</td>
<td align="right">0.0421</td>
<td align="right">0.8799</td>
<td align="right">0.4098</td>
</tr>
</tbody>
</table>
</div>
<div id="figure-3" class="section level2">
<h2>Figure 3</h2>
<pre class="r"><code>plot_split_plot &lt;- function(emm, data, traits.plot, geom = &quot;point&quot;, plot.emm = TRUE, facets=&quot;year&quot;) {
  
  data.long &lt;- data %&gt;% select(c(all_of(traits.plot), all_of(facets), water, snow)) %&gt;% 
    pivot_longer(all_of(traits.plot), names_to=&quot;trait&quot;) %&gt;% 
    mutate(trait = fct_relevel(trait, traits.plot), snow=fct_relevel(snow, &quot;Normal&quot;)) %&gt;% 
    drop_na(value, water) %&gt;% filter(trait %in% traits.plot)
  
  traitnames.multiline &lt;- ifelse(nchar(traitnames.units) &gt; 30, str_replace(traitnames.units, fixed(&quot;(&quot;),&quot;\n(&quot;), traitnames.units)
  
  split_plot &lt;- emm %&gt;% filter(trait %in% traits.plot) %&gt;% 
    mutate(trait = fct_relevel(trait, traits.plot), snow=fct_relevel(snow, &quot;Normal&quot;)) %&gt;%  
  ggplot(aes(x=water, color=snow)) +
    labs(x=&quot;Precipitation&quot;, y=&quot;Standardized trait&quot;, color=&quot;Snowmelt&quot;) + 
    scale_y_continuous(position=&quot;right&quot;) + scale_x_discrete(guide=guide_axis(angle=90)) + 
    scale_color_manual(values=snow_pal_grey, guide=guide_legend(override.aes = list(shape=15, size=ifelse(plot.emm,5,1)))) + 
    theme_minimal() + theme(text=element_text(color=&quot;black&quot;, size=14), axis.text = element_text(color=&quot;black&quot;),
                            axis.title.y= element_blank(),
                            panel.grid.major.x = element_blank(), panel.grid.minor.x=element_blank(), panel.grid.minor.y = element_blank(),
                            panel.border = element_rect(fill=NA, colour = &quot;black&quot;), 
                            panel.spacing=unit(0, &quot;pt&quot;), plot.margin = margin(0,0,0,0, &quot;pt&quot;), legend.position = &quot;top&quot;) +
    switch(facets, 
           year = facet_grid(trait ~ year, scales=&quot;free_y&quot;, switch=&quot;y&quot;, 
                             labeller = as_labeller(c(traitnames.multiline, set_names(2018:2020)))),
           year.round = facet_grid(trait ~ year.round, scales=&quot;free_y&quot;, switch=&quot;y&quot;, 
                                   labeller = as_labeller(c(traitnames.multiline, set_names(levels(lt$year.round)))))) + 
    switch(geom,
           boxplot = geom_boxplot(data=data.long, aes(y=value), position=position_dodge(width=0.8), show.legend=!plot.emm,
                                  fatten=ifelse(plot.emm, NULL, 1), outlier.size=0.5),
           violin =   geom_violin(data=data.long, aes(y=value), position=position_dodge(width=0.8), show.legend=F),
           point =     geom_point(data=data.long, aes(y=value), position=position_dodge(width=0.8), shape=3))
  
  if(plot.emm) { return(split_plot + 
                          geom_linerange(aes(ymin=emmean-SE, ymax=emmean+SE,), position=position_dodge(width=0.8), size=1, show.legend=F) +
                          geom_point(aes(y=emmean), position=position_dodge(width=0.8), shape=&quot;-&quot;, size=16))
  } else return(split_plot)
}

#Morphological traits - plot of EMMs and subplot means
split_plot.floral &lt;- grid.arrange(
  plot_split_plot(mod.split.emm, mnps.subplot, floraltraits[1:4]),
  plot_split_plot(mod.split.emm, mnps.subplot, floraltraits[5:8]) + 
    guides(color = guide_legend(override.aes = list(color=&quot;white&quot;, shape=15, size=5))) + 
    theme(legend.title = element_text(color = &quot;white&quot;), legend.text = element_text(color = &quot;white&quot;)), nrow=1)</code></pre>
<p><img src="figures/Figure_3-1.svg" width="864" /></p>
</div>
<div id="compensation" class="section level2">
<h2>Compensation</h2>
<pre class="r"><code>mnps.plantyr &lt;- mnps.plantyr %&gt;% mutate(snowwater= paste0(snow, water))
library(multcomp)#careful, this loads MASS, which overrides dplyr::select
options(contrasts = c(&quot;contr.sum&quot;, &quot;contr.poly&quot;))
mod.split.glht &lt;- c(map(set_names(floraltraits), 
                   ~ lmer(mnps.plantyr[[.x]]  ~ snowwater * year + (1|snow:plot) + (1|snow:plotid),
                          data=mnps.plantyr))) %&gt;% 
  #compare early snowmelt + addition vs. normal snowmelt + control
  map(glht, linfct = mcp(snowwater = c(&quot;EarlyAddition - NormalControl = 0&quot;))) %&gt;% 
  map_dfr(~ tibble(EarlyAddition_minus_NormalControl = coef(.x), p=summary(.x)$test$pvalues), .id=&quot;trait&quot;) 

mod.split.glht %&gt;% kable(caption=&quot;Comparisons of traits in subplots with early snowmelt but water addition vs. subplots with normal snowmelt and precipiation.&quot;)</code></pre>
<table>
<caption>Comparisons of traits in subplots with early snowmelt but water addition vs. subplots with normal snowmelt and precipiation.</caption>
<thead>
<tr class="header">
<th align="left">trait</th>
<th align="right">EarlyAddition_minus_NormalControl</th>
<th align="right">p</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">corolla_length</td>
<td align="right">0.7147</td>
<td align="right">0.2166</td>
</tr>
<tr class="even">
<td align="left">style_length</td>
<td align="right">0.3768</td>
<td align="right">0.4777</td>
</tr>
<tr class="odd">
<td align="left">corolla_width</td>
<td align="right">0.1456</td>
<td align="right">0.0328</td>
</tr>
<tr class="even">
<td align="left">sepal_width</td>
<td align="right">0.0648</td>
<td align="right">0.2286</td>
</tr>
<tr class="odd">
<td align="left">nectar_24_h_ul</td>
<td align="right">0.1174</td>
<td align="right">0.5965</td>
</tr>
<tr class="even">
<td align="left">nectar_conc</td>
<td align="right">-2.3297</td>
<td align="right">0.1453</td>
</tr>
<tr class="odd">
<td align="left">height_cm</td>
<td align="right">-3.1022</td>
<td align="right">0.0946</td>
</tr>
<tr class="even">
<td align="left">flowers_est</td>
<td align="right">5.7943</td>
<td align="right">0.4169</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="models-with-snowmelt-date-and-total-precipitation" class="section level1">
<h1>Models with snowmelt date and total precipitation</h1>
<div id="table-s2" class="section level2">
<h2>Table S2</h2>
<div id="p-values" class="section level3">
<h3>P-values</h3>
<pre class="r"><code>options(contrasts = c(&quot;contr.sum&quot;, &quot;contr.poly&quot;))
mod.abs &lt;- c(map(set_names(floraltraits), 
                 ~ lmer(mnps.plantyr[[.x]]  ~ sun_date * precip_est_mm + (1|plot) + (1|plotid), data=mnps.plantyr)))

mod.abs.coefs &lt;- map_dfr(mod.abs, tidy, .id=&quot;trait&quot;)
mod.abs.tests &lt;- map(mod.abs, anova, ddf=&quot;Ken&quot;) %&gt;% map_dfr(tidy, .id=&quot;trait&quot;)
anova_table(mod.abs.tests, mod.abs) %&gt;% kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">trait</th>
<th align="right">sun_date</th>
<th align="right">precip_est_mm</th>
<th align="right">sun_date:precip_est_mm</th>
<th align="right">R2m</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">corolla_length</td>
<td align="right">0.0000</td>
<td align="right">0.0001</td>
<td align="right">0.0064</td>
<td align="right">0.2073</td>
</tr>
<tr class="even">
<td align="left">style_length</td>
<td align="right">0.0000</td>
<td align="right">0.0462</td>
<td align="right">0.1515</td>
<td align="right">0.1678</td>
</tr>
<tr class="odd">
<td align="left">corolla_width</td>
<td align="right">0.0000</td>
<td align="right">0.0037</td>
<td align="right">0.0617</td>
<td align="right">0.2411</td>
</tr>
<tr class="even">
<td align="left">sepal_width</td>
<td align="right">0.0141</td>
<td align="right">0.0005</td>
<td align="right">0.0017</td>
<td align="right">0.0708</td>
</tr>
<tr class="odd">
<td align="left">nectar_24_h_ul</td>
<td align="right">0.0078</td>
<td align="right">0.2927</td>
<td align="right">0.8264</td>
<td align="right">0.1351</td>
</tr>
<tr class="even">
<td align="left">nectar_conc</td>
<td align="right">0.0000</td>
<td align="right">0.0508</td>
<td align="right">0.1917</td>
<td align="right">0.2888</td>
</tr>
<tr class="odd">
<td align="left">height_cm</td>
<td align="right">0.0000</td>
<td align="right">0.7391</td>
<td align="right">0.6307</td>
<td align="right">0.2249</td>
</tr>
<tr class="even">
<td align="left">flowers_est</td>
<td align="right">0.5826</td>
<td align="right">0.7083</td>
<td align="right">0.7473</td>
<td align="right">0.0010</td>
</tr>
</tbody>
</table>
</div>
<div id="regression-slopes" class="section level3">
<h3>Regression slopes</h3>
<pre class="r"><code>mod.abs.coefs %&gt;% filter(effect==&quot;fixed&quot;, term!=&quot;(Intercept)&quot;) %&gt;% pivot_wider(id_cols=trait, names_from=term, values_from=c(&quot;estimate&quot;,&quot;std.error&quot;)) %&gt;% kable()</code></pre>
<table>
<colgroup>
<col width="9%" />
<col width="10%" />
<col width="14%" />
<col width="19%" />
<col width="11%" />
<col width="14%" />
<col width="20%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">trait</th>
<th align="right">estimate_sun_date</th>
<th align="right">estimate_precip_est_mm</th>
<th align="right">estimate_sun_date:precip_est_mm</th>
<th align="right">std.error_sun_date</th>
<th align="right">std.error_precip_est_mm</th>
<th align="right">std.error_sun_date:precip_est_mm</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">corolla_length</td>
<td align="right">0.0777</td>
<td align="right">0.0797</td>
<td align="right">-4e-04</td>
<td align="right">0.0144</td>
<td align="right">0.0205</td>
<td align="right">0.0002</td>
</tr>
<tr class="even">
<td align="left">style_length</td>
<td align="right">0.0795</td>
<td align="right">0.0415</td>
<td align="right">-2e-04</td>
<td align="right">0.0145</td>
<td align="right">0.0206</td>
<td align="right">0.0002</td>
</tr>
<tr class="odd">
<td align="left">corolla_width</td>
<td align="right">0.0122</td>
<td align="right">0.0092</td>
<td align="right">0e+00</td>
<td align="right">0.0022</td>
<td align="right">0.0031</td>
<td align="right">0.0000</td>
</tr>
<tr class="even">
<td align="left">sepal_width</td>
<td align="right">0.0048</td>
<td align="right">0.0089</td>
<td align="right">-1e-04</td>
<td align="right">0.0019</td>
<td align="right">0.0025</td>
<td align="right">0.0000</td>
</tr>
<tr class="odd">
<td align="left">nectar_24_h_ul</td>
<td align="right">0.0159</td>
<td align="right">0.0089</td>
<td align="right">0e+00</td>
<td align="right">0.0059</td>
<td align="right">0.0084</td>
<td align="right">0.0001</td>
</tr>
<tr class="even">
<td align="left">nectar_conc</td>
<td align="right">-0.2102</td>
<td align="right">-0.0827</td>
<td align="right">4e-04</td>
<td align="right">0.0300</td>
<td align="right">0.0419</td>
<td align="right">0.0003</td>
</tr>
<tr class="odd">
<td align="left">height_cm</td>
<td align="right">0.2992</td>
<td align="right">0.0201</td>
<td align="right">-2e-04</td>
<td align="right">0.0430</td>
<td align="right">0.0599</td>
<td align="right">0.0005</td>
</tr>
<tr class="even">
<td align="left">flowers_est</td>
<td align="right">0.0916</td>
<td align="right">0.0887</td>
<td align="right">-6e-04</td>
<td align="right">0.1656</td>
<td align="right">0.2356</td>
<td align="right">0.0019</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="figure-4" class="section level2">
<h2>Figure 4</h2>
<pre class="r"><code>plot_abs &lt;- function(mod, data, traits.plot, tests=NULL, facets = &quot;trait&quot;) {
  data.long &lt;- data %&gt;% select(all_of(traits.plot), water, snow, year, sun_date, precip_est_mm) %&gt;% 
    pivot_longer(all_of(traits.plot), names_to=&quot;trait&quot;) %&gt;% 
    mutate(trait = fct_relevel(trait, traits.plot), snow=fct_relevel(snow, &quot;Normal&quot;),
                      value = (value - alltraits.mean[as.character(trait)])/alltraits.sd[as.character(trait)]) %&gt;% 
    drop_na(value, water) %&gt;% filter(trait %in% traits.plot)
  
  precip.breaks &lt;- seq(25,175, by=25)
  grid_emmeans &lt;- function(mods, use.rounds = F) {
    grid.points &lt;- list(sun_date=range(treatments$sun_date), precip_est_mm=precip.breaks)
    if(use.rounds)  map_dfr(mods, ~ summary(emmeans(.x, ~ precip_est_mm * sun_date * round, at=grid.points)), .id=&quot;trait&quot;)
    else            map_dfr(mods, ~ summary(emmeans(.x, ~ precip_est_mm * sun_date,         at=grid.points)), .id=&quot;trait&quot;)
  }
  emm.grid &lt;- mod[traits.plot] %&gt;% grid_emmeans(use.rounds= facets==&quot;trait.round&quot;) %&gt;% 
    mutate(trait = fct_relevel(trait, traits.plot),
           emmean = (emmean - alltraits.mean[as.character(trait)])/alltraits.sd[as.character(trait)])
  
  traitnames.multiline &lt;- ifelse(nchar(traitnames) &gt; 30, str_replace(traitnames, fixed(&quot;(&quot;),&quot;\n(&quot;), traitnames)
  if(!is.null(tests)) {
    tests.sig &lt;- tests %&gt;% filter(p.value &lt; 0.05) %&gt;% 
          mutate(term.abbr = str_replace_all(term, c(sun_date=&quot;Sn&quot;, precip_est_mm=&quot;Pr&quot;,`:`=&quot;\U00D7&quot;))) %&gt;% 
          group_by(trait) %&gt;% summarize(terms.sig = paste0(&quot;(&quot;,paste(term.abbr, collapse=&quot;, &quot;),&quot;)&quot;)) %&gt;% deframe
    traitnames.multiline[] &lt;- paste(traitnames.multiline, replace_na(tests.sig[alltraits], &quot;&quot;))
  }
  
  abs_plot &lt;- ggplot(emm.grid, aes(x=sun_date, y=emmean, color=precip_est_mm, group=precip_est_mm)) + 
    geom_point(data = data.long, aes(y=value, shape=year), size=2) + geom_line() + 
    scale_color_gradientn(colors=rev(water_pal), 
                          values=rev(c(1, (treatments %&gt;% group_by(water) %&gt;% summarize(across(precip_est_mm, mean)) %&gt;%
                                             pull(precip_est_mm) %&gt;% scales::rescale(from=range(precip.breaks)))[2],0)),
                          breaks=precip.breaks) + 
    labs(x=&quot;Snowmelt date&quot;, y=&quot;Standardized trait&quot;, color=&quot;Summer\nprecipitation\n(mm)&quot;, shape=&quot;Year&quot;) + 
    scale_y_continuous(position=&quot;right&quot;)+
    theme_minimal() + theme(text=element_text(color=&quot;black&quot;, size=14), axis.text = element_text(color=&quot;black&quot;),
                            panel.border = element_rect(fill=NA, colour = &quot;black&quot;)) +
    switch(facets, 
           trait =     facet_wrap(vars(trait), scales=&quot;fixed&quot;, dir = &quot;v&quot;, ncol=2, labeller = as_labeller(traitnames.multiline)),
           trait.round = facet_grid(trait ~ round, scales=&quot;free_y&quot;, switch=&quot;y&quot;, 
                                   labeller = as_labeller(c(traitnames.multiline, 
                                                            set_names(paste(&quot;Round&quot;,1:2), 1:2)))))
    
  return(abs_plot)
}

plot_abs(mod.abs, mnps.subplot, floraltraits, mod.abs.tests) + #Morphological traits - subplot means
  scale_y_continuous(limits=c(-1.7, 2.8), breaks=c(-1:2))</code></pre>
<p><img src="figures/Figure_4-1.svg" width="576" /></p>
</div>
<div id="compensation-1" class="section level2">
<h2>Compensation</h2>
<pre class="r"><code>mod.abs.emm.avg &lt;- map_dfr(set_names(c(&quot;sun_date&quot;,  &quot;precip_est_mm&quot;)), 
                   ~ mod.abs %&gt;% map(emtrends, var = .x, ~1) %&gt;% 
                     map(as_tibble) %&gt;% set_names(floraltraits) %&gt;% bind_rows(.id=&quot;trait&quot;) %&gt;% 
                     rename_with(.cols=ends_with(&quot;trend&quot;), ~ &quot;trend&quot;), .id=&quot;predictor&quot;) %&gt;% 
  mutate(predictor=fct_relevel(predictor,&quot;sun_date&quot;), 
         sd.plantyr = alltraits.sd[trait],
         trend = trend / sd.plantyr, SE = SE / sd.plantyr)

(mod.abs.emm.avg.compensate &lt;- mod.abs.emm.avg %&gt;% 
  pivot_wider(names_from=predictor, values_from=c(trend, SE), id_cols=c(trait)) %&gt;% 
  mutate(precip_mm_per_snow_day = trend_sun_date / trend_precip_est_mm, 
         SE = abs(precip_mm_per_snow_day) * # propagate error in SEs using formula for quotients
           sqrt((SE_precip_est_mm / trend_precip_est_mm)^2 + (SE_sun_date / trend_sun_date)^2),
         .keep=&quot;unused&quot;) %&gt;% kable(caption=&quot;The amount of precipiation (mm) required to compensate for snowmelt occuring 1 day earlier.&quot;))</code></pre>
<table>
<caption>The amount of precipiation (mm) required to compensate for snowmelt occuring 1 day earlier.</caption>
<thead>
<tr class="header">
<th align="left">trait</th>
<th align="right">precip_mm_per_snow_day</th>
<th align="right">SE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">corolla_length</td>
<td align="right">1.805</td>
<td align="right">0.4375</td>
</tr>
<tr class="even">
<td align="left">style_length</td>
<td align="right">5.416</td>
<td align="right">1.6122</td>
</tr>
<tr class="odd">
<td align="left">corolla_width</td>
<td align="right">2.635</td>
<td align="right">0.5246</td>
</tr>
<tr class="even">
<td align="left">sepal_width</td>
<td align="right">-1.069</td>
<td align="right">0.9923</td>
</tr>
<tr class="odd">
<td align="left">nectar_24_h_ul</td>
<td align="right">2.103</td>
<td align="right">0.5986</td>
</tr>
<tr class="even">
<td align="left">nectar_conc</td>
<td align="right">6.632</td>
<td align="right">1.7649</td>
</tr>
<tr class="odd">
<td align="left">height_cm</td>
<td align="right">-28.052</td>
<td align="right">28.6434</td>
</tr>
<tr class="even">
<td align="left">flowers_est</td>
<td align="right">3.819</td>
<td align="right">16.7568</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="models-with-soil-moisture" class="section level1">
<h1>Models with soil moisture</h1>
<div id="table-s1" class="section level2">
<h2>Table S1</h2>
<pre class="r"><code># VWC split-plot analysis on subplot means (for the whole measurement period)
sm.mod &lt;- lmer(VWC ~ year * snow * water + (1|snow:plot)+ (1|snow:plotid), data=sm.subplotyear)
anova(sm.mod) %&gt;% kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Sum Sq</th>
<th align="right">Mean Sq</th>
<th align="right">NumDF</th>
<th align="right">DenDF</th>
<th align="right">F value</th>
<th align="right">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">year</td>
<td align="right">21.0823</td>
<td align="right">10.5411</td>
<td align="right">2</td>
<td align="right">34.783</td>
<td align="right">50.4914</td>
<td align="right">0.0000</td>
</tr>
<tr class="even">
<td align="left">snow</td>
<td align="right">1.1642</td>
<td align="right">1.1642</td>
<td align="right">1</td>
<td align="right">5.046</td>
<td align="right">5.5765</td>
<td align="right">0.0642</td>
</tr>
<tr class="odd">
<td align="left">water</td>
<td align="right">51.0709</td>
<td align="right">25.5354</td>
<td align="right">2</td>
<td align="right">15.012</td>
<td align="right">122.3132</td>
<td align="right">0.0000</td>
</tr>
<tr class="even">
<td align="left">year:snow</td>
<td align="right">2.3509</td>
<td align="right">1.1754</td>
<td align="right">2</td>
<td align="right">34.782</td>
<td align="right">5.6303</td>
<td align="right">0.0076</td>
</tr>
<tr class="odd">
<td align="left">year:water</td>
<td align="right">4.4296</td>
<td align="right">1.1074</td>
<td align="right">4</td>
<td align="right">36.320</td>
<td align="right">5.3044</td>
<td align="right">0.0018</td>
</tr>
<tr class="even">
<td align="left">snow:water</td>
<td align="right">0.5762</td>
<td align="right">0.2881</td>
<td align="right">2</td>
<td align="right">15.013</td>
<td align="right">1.3800</td>
<td align="right">0.2817</td>
</tr>
<tr class="odd">
<td align="left">year:snow:water</td>
<td align="right">0.3480</td>
<td align="right">0.0870</td>
<td align="right">4</td>
<td align="right">36.320</td>
<td align="right">0.4168</td>
<td align="right">0.7954</td>
</tr>
</tbody>
</table>
<div id="soil-moisture-in-each-treatment" class="section level3">
<h3>Soil moisture in each treatment</h3>
<pre class="r"><code>sm.mod %&gt;% emmeans(~ snow)  %&gt;% summary() %&gt;% select(-c(df,lower.CL,upper.CL),mean_VWC=emmean) %&gt;% kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">snow</th>
<th align="right">mean_VWC</th>
<th align="right">SE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Early</td>
<td align="right">4.503</td>
<td align="right">0.1984</td>
</tr>
<tr class="even">
<td align="left">Normal</td>
<td align="right">5.128</td>
<td align="right">0.1763</td>
</tr>
</tbody>
</table>
<pre class="r"><code>sm.mod %&gt;% emmeans(~ water) %&gt;% summary() %&gt;% select(-c(df,lower.CL,upper.CL),mean_VWC=emmean) %&gt;% kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">water</th>
<th align="right">mean_VWC</th>
<th align="right">SE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Addition</td>
<td align="right">6.184</td>
<td align="right">0.1638</td>
</tr>
<tr class="even">
<td align="left">Control</td>
<td align="right">4.389</td>
<td align="right">0.1430</td>
</tr>
<tr class="odd">
<td align="left">Reduction</td>
<td align="right">3.873</td>
<td align="right">0.1638</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="table-s3" class="section level2">
<h2>Table S3</h2>
<pre class="r"><code>options(contrasts = c(&quot;contr.sum&quot;, &quot;contr.poly&quot;))
mod.sm &lt;- c(map(set_names(floraltraits), 
                  ~ lmer(mnps.plantyr[[.x]]  ~ year * VWC + (1|plotid), data=mnps.plantyr)))
mod.sm.coefs &lt;- map_dfr(mod.sm, tidy, .id=&quot;trait&quot;)
mod.sm.tests &lt;- map(mod.sm, anova, ddf=&quot;Ken&quot;) %&gt;% map_dfr(tidy, .id=&quot;trait&quot;)
anova_table(mod.sm.tests, mod.sm) %&gt;% kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">trait</th>
<th align="right">year</th>
<th align="right">VWC</th>
<th align="right">year:VWC</th>
<th align="right">R2m</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">corolla_length</td>
<td align="right">0.0066</td>
<td align="right">0.0129</td>
<td align="right">0.4492</td>
<td align="right">0.2069</td>
</tr>
<tr class="even">
<td align="left">style_length</td>
<td align="right">0.1929</td>
<td align="right">0.0021</td>
<td align="right">0.8117</td>
<td align="right">0.1767</td>
</tr>
<tr class="odd">
<td align="left">corolla_width</td>
<td align="right">0.0043</td>
<td align="right">0.0002</td>
<td align="right">0.0460</td>
<td align="right">0.2872</td>
</tr>
<tr class="even">
<td align="left">sepal_width</td>
<td align="right">0.0077</td>
<td align="right">0.0104</td>
<td align="right">0.0034</td>
<td align="right">0.0749</td>
</tr>
<tr class="odd">
<td align="left">nectar_24_h_ul</td>
<td align="right">0.2627</td>
<td align="right">0.0001</td>
<td align="right">0.1098</td>
<td align="right">0.1591</td>
</tr>
<tr class="even">
<td align="left">nectar_conc</td>
<td align="right">0.0002</td>
<td align="right">0.0106</td>
<td align="right">0.3203</td>
<td align="right">0.2835</td>
</tr>
<tr class="odd">
<td align="left">height_cm</td>
<td align="right">0.5134</td>
<td align="right">0.0808</td>
<td align="right">0.1761</td>
<td align="right">0.2177</td>
</tr>
<tr class="even">
<td align="left">flowers_est</td>
<td align="right">0.7130</td>
<td align="right">0.0821</td>
<td align="right">0.7399</td>
<td align="right">0.0118</td>
</tr>
</tbody>
</table>
</div>
<div id="figure-5" class="section level2">
<h2>Figure 5</h2>
<pre class="r"><code>plot_sm &lt;- function(mod, data, traits.plot, tests=NULL) {
  data.long &lt;- data %&gt;% select(all_of(traits.plot), water, snow, year, sun_date, precip_est_mm, VWC) %&gt;% 
    pivot_longer(all_of(traits.plot), names_to=&quot;trait&quot;) %&gt;% 
    mutate(trait = fct_relevel(trait, traits.plot), snow=fct_relevel(snow, &quot;Normal&quot;),
                      value = (value - alltraits.mean[as.character(trait)])/alltraits.sd[as.character(trait)]) %&gt;% 
    drop_na(value, water) %&gt;% filter(trait %in% traits.plot)
  
  VWC.range &lt;- range(data$VWC, na.rm=T)
  emm.grid &lt;- mod[traits.plot] %&gt;% 
    map_dfr(~ emmeans(.x, ~ year*VWC, at=list(VWC=seq(from=floor(VWC.range[1]*10)/10, to=ceiling(VWC.range[2]*10)/10, by=0.1))) %&gt;% as_tibble(), .id=&quot;trait&quot;) %&gt;% 
    mutate(trait = fct_relevel(trait, traits.plot),
           emmean = (emmean - alltraits.mean[as.character(trait)])/alltraits.sd[as.character(trait)]) %&gt;% 
    left_join(data %&gt;% drop_na(VWC) %&gt;% group_by(year) %&gt;% summarize(VWC.min = min(VWC), VWC.max=max(VWC))) %&gt;%
    group_by(year) %&gt;% filter(VWC &gt;= VWC.min-0.1, VWC &lt;= VWC.max+0.1)
  
  traitnames.multiline &lt;- ifelse(nchar(traitnames) &gt; 30, str_replace(traitnames, fixed(&quot;(&quot;),&quot;\n(&quot;), traitnames)
  if(!is.null(tests)) {
    tests.sig &lt;- tests %&gt;% filter(p.value &lt; 0.05) %&gt;% 
          mutate(term.abbr = str_replace_all(term, c(year=&quot;Yr&quot;, VWC=&quot;SM&quot;,`:`=&quot;\U00D7&quot;))) %&gt;% 
          group_by(trait) %&gt;% summarize(terms.sig = paste0(&quot;(&quot;,paste(term.abbr, collapse=&quot;, &quot;),&quot;)&quot;)) %&gt;% deframe
    traitnames.multiline[] &lt;- paste(traitnames.multiline, replace_na(tests.sig[alltraits], &quot;&quot;))
  }
  
  sm_plot &lt;- ggplot(emm.grid, aes(x=VWC, y=emmean, color=year, group=year)) + 
    facet_wrap(vars(trait), scales=&quot;fixed&quot;, dir=&quot;v&quot;, ncol=ifelse(length(traits.plot)&gt;3,2,4), labeller = as_labeller(traitnames.multiline))+
    geom_point(data = data.long, aes(y=value, color=year), size=1) +  
    geom_line(size=2) + 
    scale_color_manual(values=year_pal) + ylab(&quot;Standardized trait&quot;) + labs(color=&quot;Year&quot;) + 
    #coord_fixed() + 
    theme_minimal() + theme(text=element_text(color=&quot;black&quot;, size=14), axis.text = element_text(color=&quot;black&quot;),
                            panel.border = element_rect(fill=NA, colour = &quot;black&quot;))
  return(sm_plot)
}

plot_sm(mod.sm, mnps.plantyr, floraltraits, mod.sm.tests) + 
  scale_y_continuous(limits=c(-4.3,5)) + xlab(&quot;Summer mean of soil moisture in subplot (%VWC)&quot;)</code></pre>
<p><img src="figures/Figure_5-1.svg" width="576" /></p>
</div>
</div>
<div id="figure-6" class="section level1">
<h1>Figure 6</h1>
<p>Drawn manually from results of script “SEM_analysis.sas” executed in SAS 9.3.</p>
</div>
<div id="figure-s1" class="section level1">
<h1>Figure S1</h1>
<pre class="r"><code>  timings_labels &lt;- c(snowcloth=&quot;Snow cloths applied to early plots&quot;, 
                     meltdates=&quot;Mean early and normal snowmelt timing&quot;, 
                     waterdates=&quot;Summer precipitation treatments applied&quot;,
                     sm=&quot;Soil moisture recorded&quot;,         ph=&quot;Inflorescence height recorded&quot;, 
                     mt=&quot;Floral morphology recorded&quot;,     nt=&quot;Nectar traits recorded&quot;, 
                     pt= &quot;Physiology traits recorded&quot;,    lt=&quot;Vegetative traits recorded&quot;, 
                     sds=&quot;Flower collection period&quot;,      cen=&quot;Rosette size and survival recorded&quot;)

plot_timings &lt;- function(data) {
  data %&gt;% mutate(variable=fct_reorder(variable, begin, na.rm=T, .desc=T),
                  drawline = ifelse(variable %in% c(&quot;lt&quot;,&quot;meltdates&quot;), NA, TRUE)) %&gt;% 
ggplot(aes(y=variable, color=year))+ 
  geom_linerange(aes(xmin=begin, xmax=end, linetype=drawline), 
                 position = position_dodge2(width=0.7, reverse = T), size=1.2, show.legend=FALSE) + 
  geom_text(data=data %&gt;% drop_na(plots) %&gt;% filter(year==&quot;2019&quot;),
            aes(x = end+7, label=paste(ifelse(nchar(plots)&gt;1, &quot;Plots&quot;,&quot;Plot&quot;), str_replace(plots,&quot;,&quot;,&quot; &amp; &quot;))), 
            position = position_dodge2(width=0.8, reverse = T), size=4, hjust=0, show.legend=FALSE)+
  geom_point(aes(x=begin), position = position_dodge2(width=0.7, reverse = T), shape=15, size=2)+
  geom_point(aes(x=end), position = position_dodge2(width=0.7, reverse = T), shape=15, size=2) +
  scale_color_manual(&quot;Year&quot;, values=year_pal, guide=guide_legend(override.aes = list(size=5))) + 
  scale_y_discrete(&quot;&quot;, labels=timings_labels)+
  scale_x_continuous(&quot;Day of year&quot;, breaks=seq(80,240, by=20)) +
  theme_minimal() + theme(legend.position = &quot;top&quot;, text=element_text(size=14, color=&quot;black&quot;), axis.text = element_text(color=&quot;black&quot;),
                            panel.border = element_rect(fill=NA, colour = &quot;black&quot;))
}

plot_timings(filter(timings, !variable %in% c(&quot;sds&quot;,&quot;lt&quot;,&quot;pt&quot;,&quot;cen&quot;)))</code></pre>
<p><img src="figures/Figure_S1-1.svg" width="672" /></p>
</div>
<div id="figure-s2" class="section level1">
<h1>Figure S2</h1>
<pre class="r"><code>groundcover %&gt;% mutate(first_snow_day=first_snow_day-365) %&gt;% select(-first_snow_day) %&gt;% 
  pivot_longer(ends_with(&quot;day&quot;), names_to=&quot;threshold&quot;, values_to=&quot;day&quot;) %&gt;% drop_na(day) %&gt;% select(-starts_with(&quot;first&quot;)) %&gt;% 
  mutate(threshold = fct_reorder(factor(threshold),day, na.rm=T, .desc=T)) %&gt;% 
  ggplot(aes(x=year, y=day, color=threshold)) +  
  annotate(&quot;rect&quot;, xmin=2017.5, xmax=2020.5, ymin=-Inf, ymax=Inf, fill=&quot;lightblue&quot;)+
  geom_line(aes(group=year), size=1.5)+ geom_smooth(method=&quot;lm&quot;, se=F) +
  geom_point(aes(shape=source)) + scale_shape_manual(&quot;Source&quot;,values=c(19,17), labels=c(&quot;Observed&quot;, &quot;Inferred from peak runoff&quot;)) +
  scale_x_continuous(breaks=seq(1940,2020, by=10), minor_breaks = scales::pretty_breaks(n = 100), position = &quot;top&quot;) + scale_y_continuous(n.breaks=10)+
  scale_color_grey(labels=c(paste(c(0,50,100),&quot;cm&quot;)), start=0, end=0.85) +
  labs(x=&quot;Year&quot;, y=&quot;Day of year&quot;, color=&quot;First day snowpack below&quot;) + theme_minimal() + theme(text=element_text(color=&quot;black&quot;, size=14), axis.text = element_text(color=&quot;black&quot;),  panel.border = element_rect(fill=NA, colour = &quot;black&quot;))</code></pre>
<p><img src="figures/Figure_S2-1.svg" width="720" /></p>
<pre class="r"><code>meltdate.mod &lt;- lm(first_0_cm_day ~ year, data=groundcover)
early.melt_offset &lt;- treatments %&gt;% filter(snow==&quot;Early&quot;) %&gt;% pull(melt_offset)
yearrange &lt;- paste(range(groundcover$year), collapse=&quot; - &quot;)

meltdate.mod %&gt;% tidy() %&gt;% kable(caption=paste(&quot;Regression of snowmelt date vs. year from&quot;,yearrange))</code></pre>
<table>
<caption>Regression of snowmelt date vs. year from 1935 - 2021</caption>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">411.2126</td>
<td align="right">97.0568</td>
<td align="right">4.237</td>
<td align="right">0.0001</td>
</tr>
<tr class="even">
<td align="left">year</td>
<td align="right">-0.1361</td>
<td align="right">0.0491</td>
<td align="right">-2.775</td>
<td align="right">0.0068</td>
</tr>
</tbody>
</table>
<pre class="r"><code>cat(&quot;Snowmelt is advancing&quot;,-10*tidy(meltdate.mod)$estimate[2],&quot;+-&quot;,10*tidy(meltdate.mod)$std.error[2], &quot;days per decade&quot;)</code></pre>
<pre><code>Snowmelt is advancing 1.361 +- 0.4906 days per decade</code></pre>
<pre class="r"><code>cat(&quot;Early snow treatments melted&quot;, -round(mean(early.melt_offset),1), &quot;+-&quot;, round(sd(early.melt_offset),1), &quot;days earlier (mean +- SD), which is equivalent to&quot;, mean(early.melt_offset)/tidy(meltdate.mod)$estimate[2], &quot;+-&quot;, (mean(early.melt_offset)/tidy(meltdate.mod)$estimate[2])*sqrt((sd(early.melt_offset)/mean(early.melt_offset))^2 + (tidy(meltdate.mod)$std.error[2]/tidy(meltdate.mod)$estimate[2])^2), &quot;years of future warming&quot;)#propagate error from SD of treatment advance and SE of regression</code></pre>
<pre><code>Early snow treatments melted 5.7 +- 2.2 days earlier (mean +- SD), which is equivalent to 41.78 +- 22.12 years of future warming</code></pre>
</div>
<div id="figure-s3" class="section level1">
<h1>Figure S3</h1>
<pre class="r"><code>max_VWC &lt;- max(sm.subplot$VWC, na.rm=T)
ggplot(sm.subplot, aes(x=yday(date))) + 
  facet_wrap(vars(year), ncol=1) +
  geom_segment(data=waterdates %&gt;% pivot_wider(names_from=precip_treatments, values_from=c(day,date)),
               aes(x=day_started, xend=day_ended, y=max_VWC+0.5, yend=max_VWC+0.5)) +
  geom_col(data=daily_precip_est, aes(x=yday(date), y=EPA_NOAA_filled), fill=brewer.pal(7, &quot;Set3&quot;)[7]) +
  geom_line(data=daily_precip_est, aes(y=VWC_Control_4*100), color=brewer.pal(7, &quot;Set3&quot;)[6], size=1) +
  geom_point(aes(shape=snow, color=water, y = VWC)) + 
  geom_line(data=sm.subplot %&gt;% group_by(water, snow, year, date) %&gt;% summarize(VWC=mean(VWC, na.rm=T)), aes(linetype=snow, color=water, y = VWC)) +
  scale_color_manual(values=water_pal) +  scale_linetype_manual(values=c(2,1)) + 
  geom_vline(data=meltdates, aes(xintercept=sun_date, linetype=snow), color=&quot;black&quot;, show.legend=F) +
  coord_cartesian(xlim=c(110, 230), ylim=c(0, max_VWC+1), expand=F)+
  labs(x=&quot;Day of year&quot;, y=&quot;Mean soil moisture in subplot (%VWC) / Precipitation (mm)&quot;, color=&quot;Precipitation&quot;, shape=&quot;Snowmelt&quot;, linetype=&quot;Snowmelt&quot;) + theme_minimal() + theme(legend.key.width = unit(2, &quot;lines&quot;), text=element_text(color=&quot;black&quot;, size=14), axis.text = element_text(color=&quot;black&quot;), panel.border = element_rect(fill=NA, colour = &quot;black&quot;))</code></pre>
<p><img src="figures/Figure_S3-1.svg" width="864" /></p>
</div>
<div id="figure-s4" class="section level1">
<h1>Figure S4</h1>
<pre class="r"><code>mt.morph.plantyr &lt;- mt.plantyr[,c(&quot;corolla_length&quot;, &quot;corolla_width&quot;,&quot;style_length&quot;,&quot;anther_max&quot;,&quot;anther_min&quot;,&quot;year&quot;,&quot;VWC&quot;)] %&gt;% drop_na() 
options(contrasts = c(&quot;contr.treatment&quot;, &quot;contr.poly&quot;))
mt.rda &lt;- rda(scale(select(mt.morph.plantyr, !c(year, VWC))) ~ VWC * year, data=mt.morph.plantyr)

mt.rda.df &lt;- fortify(update(mt.rda, ~ VWC + year))#drop interaction
ggplot(mapping=aes(x=RDA1, y=RDA2, label=Label)) + 
  geom_point(data=mt.rda.df %&gt;% filter(Score==&quot;sites&quot;) %&gt;% bind_cols(mt.morph.plantyr), aes(color=VWC))+
  geom_segment(data=mt.rda.df %&gt;% filter(Label==&quot;VWC&quot;), aes(x=0,y=0,xend=RDA1*3, yend=RDA2*3), 
               arrow=arrow(length=unit(0.5, &quot;lines&quot;)), size=1.5)+
  geom_text(   data=mt.rda.df %&gt;% filter(Label==&quot;VWC&quot;), aes(x=RDA1*3.7, y=RDA2*3.7, angle=atan(RDA2/RDA1)*180/pi), label=&quot;Soil moisture&quot;)+
  geom_segment(data=mt.rda.df %&gt;% filter(Score==&quot;species&quot;), aes(x=0,y=0,xend=RDA1, yend=RDA2), 
               arrow=arrow(length=unit(0.5, &quot;lines&quot;)))+
  geom_text(   data=mt.rda.df %&gt;% filter(Score==&quot;species&quot;), aes(x=RDA1*1.7, y=RDA2*1.7, angle=atan(RDA2/RDA1)*180/pi,
    label = c(traitnames, c(&quot;anther_max&quot;=&quot;Max stamen length&quot;, &quot;anther_min&quot;=&quot;Min stamen length&quot;))[as.character(Label)] %&gt;% str_remove(fixed(&quot; (mm)&quot;))), size=3)+
  geom_text(data=mt.rda.df %&gt;% filter(Score==&quot;centroids&quot;), aes(label=str_remove(Label, &quot;year&quot;)), fontface=2, size=6)+
  scale_color_viridis(&quot;Soil\nmoisture\n(%VWC)&quot;, direction=-1, option=&quot;plasma&quot;) + coord_fixed() + 
  scale_x_continuous(expand=expansion(mult=.16), breaks=c(-2,0,2))+   theme_minimal() + 
  theme(panel.grid.minor=element_blank(), text=element_text(color=&quot;black&quot;, size=14), axis.text = element_text(color=&quot;black&quot;),
                            panel.border = element_rect(fill=NA, colour = &quot;black&quot;))</code></pre>
<p><img src="figures/Figure_S4-1.svg" width="768" /></p>
<div id="rda-summary-and-test" class="section level2">
<h2>RDA summary and test</h2>
<pre class="r"><code>mt.rda</code></pre>
<pre><code>Call: rda(formula = scale(select(mt.morph.plantyr, !c(year, VWC))) ~
VWC * year, data = mt.morph.plantyr)

              Inertia Proportion Rank
Total           5.000      1.000     
Constrained     1.221      0.244    5
Unconstrained   3.779      0.756    5
Inertia is variance 

Eigenvalues for constrained axes:
 RDA1  RDA2  RDA3  RDA4  RDA5 
1.150 0.058 0.010 0.003 0.000 

Eigenvalues for unconstrained axes:
  PC1   PC2   PC3   PC4   PC5 
2.495 0.671 0.400 0.121 0.092 </code></pre>
<pre class="r"><code>anova(mt.rda, by=&quot;term&quot;)</code></pre>
<pre><code>Permutation test for rda under reduced model
Terms added sequentially (first to last)
Permutation: free
Number of permutations: 999

Model: rda(formula = scale(select(mt.morph.plantyr, !c(year, VWC))) ~ VWC * year, data = mt.morph.plantyr)
          Df Variance     F Pr(&gt;F)    
VWC        1     0.57 67.20  0.001 ***
year       2     0.64 37.49  0.001 ***
VWC:year   2     0.02  0.99  0.362    
Residual 446     3.78                 
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
</div>
</div>
<div id="figure-s5" class="section level1">
<h1>Figure S5</h1>
<p>Drawn manually from results of script “SEM_analysis.sas” executed in SAS 9.3.</p>
</div>
<div id="figure-s6" class="section level1">
<h1>Figure S6</h1>
<pre class="r"><code>summary_EPA_NOAA &lt;- daily_filled_7am %&gt;% filter(year(date)&gt;1989, year(date)&lt;2021, EPA_NOAA_filled &gt; 2) %&gt;% 
  mutate(drought_days = c(0,diff(date)), year=year(date)) %&gt;% filter(ground_covered==&quot;smmr&quot;) %&gt;% 
  select(year, date, drought_days) %&gt;% group_by(year) %&gt;% summarize(max_drought_days_2mm = max(drought_days)) %&gt;% 
  left_join(daily_filled_7am  %&gt;% filter(year(date)&gt;1989, year(date)&lt;2021, ground_covered==&quot;smmr&quot;) %&gt;% group_by(year=year(date)) %&gt;% 
              summarize(snow_free_days = n(),
                        rain_days_2mm = sum(EPA_NOAA_filled &gt; 2, na.rm=T),
                        prop_rain_days_2mm = rain_days_2mm / snow_free_days,
                        max_precip_mm = max(EPA_NOAA_filled, na.rm=T),
                        avg_precip_mm = mean(EPA_NOAA_filled, na.rm=T),
                        total_precip_mm = sum(EPA_NOAA_filled, na.rm=T)))

summary_names &lt;- c(snow_free_days = &quot;Snowmelt to first permanent snowfall (days)&quot;,
                   max_drought_days_2mm=&quot;Longest drought &lt; 2 mm/day (days)&quot;, 
                   rain_days_2mm = &quot;Days with &gt; 2 mm precipitation&quot;,
                   prop_rain_days_2mm = &quot;Proportion days &gt; 2 mm precipitation&quot;,
                   max_precip_mm = &quot;Maximum precipitation (mm/day)&quot;,
                   avg_precip_mm = &quot;Average precipitation (mm/day)&quot;,
                   total_precip_mm = &quot;Total precipitation (mm)&quot;)

summary_EPA_NOAA %&gt;% pivot_longer(!year) %&gt;% filter(!name %in% c(&quot;rain_days_2mm&quot;,&quot;max_precip_mm&quot;,&quot;total_precip_mm&quot;)) %&gt;% 
  ggplot(aes(y=value, x=year))+ 
  facet_wrap(vars(name), scales=&quot;free_y&quot;, labeller=as_labeller(summary_names)) +
  annotate(&quot;rect&quot;, xmin=2017.5, xmax=2020.5, ymin=-Inf, ymax=Inf, fill=&quot;lightblue&quot;)+
  geom_smooth(method=&quot;lm&quot;, color=&quot;black&quot;, se=F) + geom_point(color=&quot;grey60&quot;) + labs(x=&quot;Year&quot;, y=&quot;&quot;) + 
  stat_poly_eq(formula = y ~ x, aes(label = paste(..eq.label.., ..rr.label.., ..p.value.label.., sep = &quot;~~~&quot;)), parse = T) +
  theme_minimal() +theme(axis.title.y= element_blank(), text=element_text(color=&quot;black&quot;, size=14), 
                         axis.text = element_text(color=&quot;black&quot;),  panel.border = element_rect(fill=NA, colour = &quot;black&quot;))</code></pre>
<p><img src="figures/Figure_S6-1.svg" width="672" /></p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
